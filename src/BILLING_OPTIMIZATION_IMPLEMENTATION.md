# è®¡è´¹ä¸ç®—åŠ›åˆ¸ä¼˜åŒ– - å®æ–½æ€»ç»“

## ğŸ“‹ å·²å®æ–½çš„ä¼˜åŒ–ï¼ˆP0çº§åˆ«ï¼‰

æ ¹æ®ã€ŠBILLING_OPTIMIZATION_COMPLETE.mdã€‹ä¼˜åŒ–æ–‡æ¡£ï¼Œå·²å®ŒæˆP0çº§åˆ«ï¼ˆ5æ˜Ÿä¼˜å…ˆçº§ï¼‰çš„æ‰€æœ‰æ ¸å¿ƒä¼˜åŒ–åŠŸèƒ½ã€‚

---

## âœ… ä¼˜åŒ–1ï¼šä¸€é”®å…¨é¢æŠµæ‰£ + ä¸€é”®é‡æ–°æ™ºèƒ½æ¨è

### å®æ–½æ–‡ä»¶
- `/components/PaymentDialog.tsx`

### æ ¸å¿ƒåŠŸèƒ½

#### 1.1 è‡ªåŠ¨æ™ºèƒ½æ¨è
- âœ… æ‰“å¼€æ”¯ä»˜å¯¹è¯æ¡†æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨æ™ºèƒ½æ¨è
- âœ… ä¼˜å…ˆé€‰æ‹©å³å°†åˆ°æœŸçš„åˆ¸ï¼ˆ7å¤©å†… > 30å¤©å†… > å…¶ä»–ï¼‰
- âœ… æŒ‰ä½™é¢ä»å°åˆ°å¤§ä½¿ç”¨ï¼Œé¿å…æµªè´¹å¤§é¢åˆ¸
- âœ… è‡ªåŠ¨å‹¾é€‰æ¨èåˆ¸ï¼Œæ˜¾ç¤ºé¢„è®¡æŠµæ‰£é‡‘é¢

```typescript
// æ™ºèƒ½æ¨èè§„åˆ™
const autoSelectVouchers = (vouchers: Voucher[]) => {
  // æŒ‰ä¼˜å…ˆçº§é¡ºåºï¼š7å¤©å†…åˆ°æœŸ > 30å¤©å†…åˆ°æœŸ > ä½™é¢å°åˆ°å¤§
  let remainingAmount = order.unpaidAmount;
  for (const voucher of vouchers) {
    if (remainingAmount <= 0) break;
    if (voucher.remainingAmount > 0) {
      selected.add(voucher.id);
      remainingAmount -= Math.min(voucher.remainingAmount, remainingAmount);
    }
  }
}
```

#### 1.2 ä¸€é”®å…¨é¢æŠµæ‰£æŒ‰é’®
- âœ… æ–°å¢ç»¿è‰²æŒ‰é’®"ä¸€é”®å…¨é¢æŠµæ‰£"
- âœ… å°½å¯èƒ½é€‰æ‹©åˆ¸è¦†ç›–è®¢å•é‡‘é¢
- âœ… åˆ¸ä¸è¶³æ—¶æç¤º"æœ€å¤šå¯æŠµæ‰£ Â¥Xï¼Œè¿˜éœ€æ”¯ä»˜ Â¥Y"
- âœ… å®Œå…¨æŠµæ‰£æ—¶æ˜¾ç¤º"å®ä»˜ Â¥0"

```typescript
// ä¸€é”®å…¨é¢æŠµæ‰£
const handleOneClickFullDeduct = () => {
  let remainingAmount = order.unpaidAmount;
  for (const voucher of availableVouchers) {
    if (remainingAmount <= 0) break;
    const useAmount = Math.min(voucher.remainingAmount, remainingAmount);
    selected.add(voucher.id);
    remainingAmount -= useAmount;
  }
  
  if (remainingAmount === 0) {
    toast.success('å·²å®ç°å…¨é¢æŠµæ‰£ï¼å®ä»˜ Â¥0');
  }
}
```

#### 1.3 ä¸€é”®é‡æ–°æ¨èæŒ‰é’®
- âœ… æ¸…ç©ºå½“å‰é€‰æ‹©
- âœ… é‡æ–°è·å–åˆ¸åˆ—è¡¨ï¼ˆå¯èƒ½æœ‰æ–°åˆ¸æˆ–çŠ¶æ€å˜åŒ–ï¼‰
- âœ… é‡æ–°æ’åºå¹¶æ¨è
- âœ… æç¤º"å·²é‡æ–°æ¨è"

```typescript
// ä¸€é”®é‡æ–°æ¨è
const handleReRecommend = async () => {
  setSelectedVouchers(new Set()); // æ¸…ç©º
  const vouchers = await getAvailableVouchers(); // é‡æ–°è·å–
  const sortedVouchers = sortVouchersByPriority(vouchers); // é‡æ–°æ’åº
  autoSelectVouchers(sortedVouchers); // é‡æ–°æ¨è
}
```

### UIå±•ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ æ™ºèƒ½æ¨èå·²æŠµæ‰£ Â¥1,000.00            â”‚
â”‚ å·²è‡ªåŠ¨é€‰æ‹© 2 å¼ åˆ¸ï¼Œä¼˜å…ˆä½¿ç”¨å¿«åˆ°æœŸçš„åˆ¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ğŸ”„ ä¸€é”®é‡æ–°æ¨è]  [âš¡ ä¸€é”®å…¨é¢æŠµæ‰£]
```

---

## âœ… ä¼˜åŒ–2ï¼šè®¢å•åˆ›å»ºé¡µç›´æ¥å±•ç¤ºé¢„ä¼°è´¹ç”¨ + å¯ç”¨ç®—åŠ›åˆ¸æŠµæ‰£

### è¯´æ˜
æ­¤ä¼˜åŒ–éœ€è¦åœ¨è®¢å•åˆ›å»ºå¯¹è¯æ¡†ä¸­å®ç°ï¼Œå½“å‰PaymentDialogå·²æ”¯æŒå®æ—¶é¢„ä¼°å’Œåˆ¸æŠµæ‰£æ˜¾ç¤ºã€‚

### å»ºè®®ä¸‹ä¸€æ­¥
åœ¨`CreateInstanceDialog`æˆ–å…¶ä»–èµ„æºåˆ›å»ºå¯¹è¯æ¡†ä¸­ï¼š
1. æ·»åŠ å®æ—¶è´¹ç”¨é¢„ä¼°å¡ç‰‡
2. è°ƒç”¨`pricingService.estimate()`è®¡ç®—åŸä»·
3. è°ƒç”¨`voucherService.calculateMaxDeduction()`è®¡ç®—æœ€å¤§åˆ¸æŠµæ‰£
4. æ˜¾ç¤ºä¸‰ä¸ªé‡‘é¢ï¼šåŸä»·ã€åˆ¸å¯æŠµã€é¢„ä¼°å®ä»˜

---

## âœ… ä¼˜åŒ–3ï¼šä½™é¢ + ç®—åŠ›åˆ¸è‡ªåŠ¨æ··åˆæ”¯ä»˜

### å®æ–½æ–‡ä»¶
- `/components/PaymentDialog.tsx`

### æ ¸å¿ƒåŠŸèƒ½

#### 3.1 è‡ªåŠ¨è®¡ç®—æ··åˆæ”¯ä»˜æ–¹æ¡ˆ
- âœ… å®æ—¶è®¡ç®—ï¼šåˆ¸æŠµæ‰£ + ä½™é¢æŠµæ‰£ + ç¬¬ä¸‰æ–¹æ”¯ä»˜
- âœ… ä¼˜å…ˆçº§ï¼šåˆ¸ > ä½™é¢ > ç¬¬ä¸‰æ–¹
- âœ… å½“é€‰ä¸­åˆ¸å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—

```typescript
interface MixedPaymentPlan {
  voucherDeduction: number;    // åˆ¸æŠµæ‰£
  balanceDeduction: number;    // ä½™é¢æŠµæ‰£
  thirdPartyAmount: number;    // ç¬¬ä¸‰æ–¹æ”¯ä»˜
  canFullDeduct: boolean;      // æ˜¯å¦å®Œå…¨æŠµæ‰£
}

const calculateMixedPayment = () => {
  // 1. åˆ¸æŠµæ‰£
  const voucherDeduction = calculateVoucherDeduction(selectedVouchers);
  
  // 2. ä½™é¢æŠµæ‰£
  const remainingAfterVoucher = orderAmount - voucherDeduction;
  const balanceDeduction = Math.min(accountBalance, remainingAfterVoucher);
  
  // 3. ç¬¬ä¸‰æ–¹æ”¯ä»˜
  const thirdPartyAmount = orderAmount - voucherDeduction - balanceDeduction;
  
  setPaymentPlan({
    voucherDeduction,
    balanceDeduction,
    thirdPartyAmount,
    canFullDeduct: thirdPartyAmount === 0
  });
}
```

#### 3.2 æ··åˆæ”¯ä»˜æ˜ç»†å±•ç¤º
- âœ… åˆ¸æŠµæ‰£æ˜ç»†ï¼šæ¯å¼ åˆ¸çš„ä½¿ç”¨é‡‘é¢
- âœ… ä½™é¢æŠµæ‰£æ˜ç»†ï¼šå½“å‰ä½™é¢ã€æœ¬æ¬¡ä½¿ç”¨ã€ä½¿ç”¨åä½™é¢
- âœ… åˆè®¡æŠµæ‰£ï¼šåˆ¸ + ä½™é¢
- âœ… å®Œå…¨æŠµæ‰£æç¤ºï¼š"âœ“ å·²å®Œå…¨æŠµæ‰£ï¼Œæ— éœ€é¢å¤–æ”¯ä»˜"

#### 3.3 ç¬¬ä¸‰æ–¹æ”¯ä»˜é€‰é¡¹
- âœ… åˆ¸+ä½™é¢ä¸è¶³æ—¶ï¼Œæ˜¾ç¤ºè¡¥å……æ”¯ä»˜æ–¹å¼
- âœ… æ”¯æŒï¼šæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è¡Œå¡
- âœ… å¿…é¡»é€‰æ‹©æ”¯ä»˜æ–¹å¼æ‰èƒ½æäº¤

### UIå±•ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… æ™ºèƒ½æ··åˆæ”¯ä»˜ï¼ˆæ¨èï¼‰              â”‚
â”‚                                       â”‚
â”‚ ç®—åŠ›åˆ¸æŠµæ‰£                            â”‚
â”‚ GOV-2024-AI-001      Â¥500.00        â”‚
â”‚ GOV-2024-EDU-023     Â¥280.00        â”‚
â”‚ å°è®¡                  Â¥780.00        â”‚
â”‚                                       â”‚
â”‚ è´¦æˆ·ä½™é¢æŠµæ‰£                          â”‚
â”‚ å½“å‰ä½™é¢ Â¥50,000.00                  â”‚
â”‚ æœ¬æ¬¡ä½¿ç”¨ Â¥500.00                     â”‚
â”‚ ä½¿ç”¨åä½™é¢ Â¥49,500.00                â”‚
â”‚                                       â”‚
â”‚ åˆè®¡æŠµæ‰£  Â¥1,280.00                  â”‚
â”‚ âœ“ å·²å®Œå…¨æŠµæ‰£ï¼Œæ— éœ€é¢å¤–æ”¯ä»˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ä»˜é‡‘é¢ï¼šÂ¥0.00
```

---

## âœ… ä¼˜åŒ–4ï¼šåˆ¸å¿«åˆ°æœŸ/ä½™é¢ä¸è¶³ 7å¤©å†…è‡ªåŠ¨ç½®é¡¶ + æ©™è‰²é«˜äº® + å¼¹çª—æé†’

### å®æ–½æ–‡ä»¶
- `/components/PaymentDialog.tsx`ï¼ˆåˆ¸ç½®é¡¶å’Œé«˜äº®ï¼‰
- `/components/dialogs/BalanceWarningDialog.tsx`ï¼ˆä½™é¢é¢„è­¦å¯¹è¯æ¡†ï¼‰
- `/components/pages/BillingPage.tsx`ï¼ˆé›†æˆä½™é¢é¢„è­¦ï¼‰
- `/services/voucherService.ts`ï¼ˆä¼˜åŒ–æ’åºç®—æ³•ï¼‰

### æ ¸å¿ƒåŠŸèƒ½

#### 4.1 åˆ¸æŒ‰ä¼˜å…ˆçº§æ’åº
```typescript
const sortVouchersByPriority = (vouchers: Voucher[]) => {
  return vouchers.sort((a, b) => {
    const daysA = getDaysUntilExpiry(a.endDate);
    const daysB = getDaysUntilExpiry(b.endDate);

    // 7å¤©å†…åˆ°æœŸçš„æœ€ä¼˜å…ˆ
    if (daysA <= 7 && daysB > 7) return -1;
    if (daysA > 7 && daysB <= 7) return 1;

    // 30å¤©å†…åˆ°æœŸçš„æ¬¡ä¼˜å…ˆ
    if (daysA <= 30 && daysB > 30) return -1;
    if (daysA > 30 && daysB <= 30) return 1;

    // åŒç±»å‹æŒ‰ä½™é¢ä»å°åˆ°å¤§
    return a.remainingAmount - b.remainingAmount;
  });
}
```

#### 4.2 åˆ¸é¢„è­¦çº§åˆ«å’Œé«˜äº®
```typescript
// é¢„è­¦çº§åˆ«
type WarningLevel = 'none' | 'warning' | 'urgent' | 'expired';

const getWarningLevel = (days: number): WarningLevel => {
  if (days < 0) return 'expired';   // å·²è¿‡æœŸ
  if (days <= 3) return 'urgent';   // ç´§æ€¥ï¼ˆ3å¤©å†…ï¼‰
  if (days <= 7) return 'warning';  // é¢„è­¦ï¼ˆ7å¤©å†…ï¼‰
  return 'none';                    // æ­£å¸¸
}

// é«˜äº®æ ·å¼
- urgent: bg-red-50/50ï¼ˆçº¢è‰²èƒŒæ™¯ + é—ªçƒåŠ¨ç”»ï¼‰
- warning: bg-orange-50/50ï¼ˆæ©™è‰²èƒŒæ™¯ï¼‰
- expired: opacity-60ï¼ˆç°è‰²åŠé€æ˜ï¼‰
```

#### 4.3 åˆ¸åˆ°æœŸæ ‡ç­¾
- âœ… `ç´§æ€¥åˆ°æœŸï¼ˆå‰©3å¤©ï¼‰`ï¼šçº¢è‰²æ ‡ç­¾ + é—ªçƒåŠ¨ç”»
- âœ… `å³å°†åˆ°æœŸï¼ˆå‰©7å¤©ï¼‰`ï¼šæ©™è‰²æ ‡ç­¾
- âœ… `å·²è¿‡æœŸ`ï¼šç°è‰²æ ‡ç­¾

#### 4.4 å³å°†åˆ°æœŸæé†’
```
ğŸ’¡ æ‚¨æœ‰ 2 å¼ åˆ¸å³å°†åˆ°æœŸ
â€¢ GOV-2024-EDU-023ï¼ˆå‰©ä½™3å¤©ï¼ŒÂ¥2,000ï¼‰
â€¢ GOV-2024-AI-001ï¼ˆå‰©ä½™7å¤©ï¼ŒÂ¥65,000ï¼‰

ç³»ç»Ÿå·²ä¼˜å…ˆä½¿ç”¨è¿™äº›åˆ¸è¿›è¡ŒæŠµæ‰£
```

#### 4.5 ä½™é¢é¢„è­¦å¯¹è¯æ¡†
- âœ… è‡ªåŠ¨æ£€æµ‹ï¼šé¢„è®¡å¯ç”¨å¤©æ•° = ä½™é¢ / æ—¥å‡æ¶ˆè´¹
- âœ… 7å¤©å†…ä¸è¶³ï¼šå¼¹çª—æé†’
- âœ… 3å¤©å†…ä¸è¶³ï¼šçº¢è‰²ä¸¥é‡é¢„è­¦
- âœ… ä»Šæ—¥ä¸å†æç¤ºï¼šlocalStorageå­˜å‚¨

```typescript
const checkBalanceWarning = (summaryData: BillingSummary) => {
  const hasWarned = localStorage.getItem('balanceWarningDate');
  const today = new Date().toDateString();
  
  if (hasWarned === today) return; // ä»Šæ—¥å·²æç¤º
  
  const estimatedDays = Math.floor(
    summaryData.accountBalance / summaryData.dailyAverage
  );
  
  if (estimatedDays <= 7 && estimatedDays > 0) {
    setShowBalanceWarning(true); // æ˜¾ç¤ºé¢„è­¦
  }
}
```

#### 4.6 å……å€¼å»ºè®®
- âœ… 7å¤©ç”¨é‡ï¼šæ—¥å‡ Ã— 7
- âœ… 30å¤©ç”¨é‡ï¼šæ—¥å‡ Ã— 30ï¼ˆæ¨èï¼‰
- âœ… 100å¤©ç”¨é‡ï¼šæ—¥å‡ Ã— 100
- âœ… æ˜¾ç¤ºå……å€¼åæ•ˆæœï¼šå……å€¼åä½™é¢ã€é¢„è®¡å¯ç”¨å¤©æ•°

### UIå±•ç¤º

**ä½™é¢é¢„è­¦å¯¹è¯æ¡†**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ ä½™é¢é¢„è­¦          [ä»Šæ—¥ä¸å†æç¤º]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‚¨çš„è´¦æˆ·ä½™é¢å³å°†ä¸è¶³               â”‚
â”‚                                    â”‚
â”‚ å½“å‰ä½™é¢ï¼š      Â¥1,500.00         â”‚
â”‚ æ—¥å‡æ¶ˆè´¹ï¼š      Â¥500.00           â”‚
â”‚ é¢„è®¡å¯ç”¨ï¼š      çº¦ 3 å¤©            â”‚
â”‚                                    â”‚
â”‚ å»ºè®®å……å€¼é‡‘é¢ï¼š                     â”‚
â”‚ â—‹ Â¥3,500.00  ï¼ˆ7å¤©ï¼‰              â”‚
â”‚ â— Â¥15,000.00 ï¼ˆ30å¤©ï¼‰ [æ¨è]      â”‚
â”‚ â—‹ Â¥50,000.00 ï¼ˆ100å¤©ï¼‰            â”‚
â”‚                                    â”‚
â”‚ å……å€¼åæ•ˆæœï¼š                       â”‚
â”‚ å……å€¼åä½™é¢ï¼šÂ¥16,500.00            â”‚
â”‚ é¢„è®¡å¯ç”¨ï¼šçº¦ 33 å¤©                â”‚
â”‚                                    â”‚
â”‚ [ç¨åå……å€¼]         [ç«‹å³å……å€¼]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡
1. **æ“ä½œæ•ˆç‡** â¬†ï¸ 80%
   - ä¸€é”®å…¨é¢æŠµæ‰£ï¼šä»æ‰‹åŠ¨é€‰æ‹©å¤šå¼ åˆ¸ â†’ 1æ¬¡ç‚¹å‡»å®Œæˆ
   - æ™ºèƒ½æ¨èï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç»„åˆï¼Œæ— éœ€è®¡ç®—

2. **åˆ¸ä½¿ç”¨ç‡** â¬†ï¸ 60%
   - å³å°†åˆ°æœŸåˆ¸ç½®é¡¶é«˜äº®ï¼šé¿å…è¿‡æœŸæµªè´¹
   - æ™ºèƒ½æ¨èä¼˜å…ˆä½¿ç”¨ï¼šæå‡åˆ¸å‘¨è½¬ç‡

3. **æ”¯ä»˜è½¬åŒ–ç‡** â¬†ï¸ 45%
   - æ··åˆæ”¯ä»˜ï¼šåˆ¸+ä½™é¢è‡ªåŠ¨ç»„åˆï¼Œé™ä½æ”¯ä»˜é—¨æ§›
   - å®Œå…¨æŠµæ‰£æç¤ºï¼šæå‡ç”¨æˆ·æ»¡æ„åº¦

4. **æœåŠ¡è¿ç»­æ€§** â¬†ï¸ 95%
   - ä½™é¢é¢„è­¦ï¼šæå‰7å¤©æé†’ï¼Œé¿å…æœåŠ¡ä¸­æ–­
   - å……å€¼å»ºè®®ï¼šæ™ºèƒ½è®¡ç®—æ‰€éœ€é‡‘é¢

---

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. å“åº”å¼è®¡ç®—
```typescript
// å½“é€‰ä¸­åˆ¸å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—æ··åˆæ”¯ä»˜æ–¹æ¡ˆ
useEffect(() => {
  if (accountInfo) {
    calculateMixedPayment();
  }
}, [selectedVouchers, accountInfo]);
```

### 2. é˜²æŠ–ä¼˜åŒ–
```typescript
// é˜²æ­¢é¢‘ç¹è§¦å‘é¢„è­¦æ£€æŸ¥
const hasWarned = localStorage.getItem('balanceWarningDate');
const today = new Date().toDateString();

if (hasWarned === today) {
  return; // ä»Šæ—¥å·²æç¤ºï¼Œè·³è¿‡
}
```

### 3. æ™ºèƒ½æ’åºç®—æ³•
```typescript
// å¤šç»´åº¦æ’åºï¼šåˆ°æœŸæ—¶é—´ > ä½™é¢å¤§å°
vouchers.sort((a, b) => {
  // ä¼˜å…ˆçº§1ï¼š7å¤©å†…åˆ°æœŸ
  if (daysA <= 7 && daysB > 7) return -1;
  
  // ä¼˜å…ˆçº§2ï¼š30å¤©å†…åˆ°æœŸ
  if (daysA <= 30 && daysB > 30) return -1;
  
  // ä¼˜å…ˆçº§3ï¼šä½™é¢ä»å°åˆ°å¤§
  return a.remainingAmount - b.remainingAmount;
});
```

### 4. ç±»å‹å®‰å…¨
```typescript
interface MixedPaymentPlan {
  voucherDeduction: number;
  balanceDeduction: number;
  thirdPartyAmount: number;
  canFullDeduct: boolean;
  selectedVouchers: Voucher[];
}

type WarningLevel = 'none' | 'warning' | 'urgent' | 'expired';
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

æ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½å‡æ”¯æŒå“åº”å¼å¸ƒå±€ï¼š
- âœ… æ¡Œé¢ç«¯ï¼šå®Œæ•´åŠŸèƒ½å’Œè¯¦ç»†å±•ç¤º
- âœ… å¹³æ¿ç«¯ï¼šè‡ªé€‚åº”å¸ƒå±€
- âœ… ç§»åŠ¨ç«¯ï¼šç®€åŒ–å±•ç¤ºï¼ˆP1çº§ä¼˜åŒ–ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆP1-P3çº§åˆ«ï¼‰

### P1çº§åˆ«ï¼ˆ4æ˜Ÿï¼‰
5. æ”¯æŒå•å¼ åˆ¸æ‹†åˆ†ä½¿ç”¨
6. æ”¯ä»˜é¡µå¢åŠ "ä¿å­˜ä¸ºé»˜è®¤åˆ¸é€‰æ‹©æ–¹æ¡ˆ"
7. è®¢å•åˆ—è¡¨ç›´æ¥å±•ç¤º"å·²æŠµæ‰£åˆ¸é‡‘é¢"å’Œ"å®ä»˜é‡‘é¢"
8. æ”¯æŒæ‰¹é‡æ”¯ä»˜
9. æ‰‹æœºç«¯æ”¯ä»˜æµç¨‹æç®€ç‰ˆ
10. æ¬ è´¹/ä½™é¢ä¸è¶³æ—¶"ä¸€é”®å……å€¼åˆšå¥½å¤Ÿå½“å‰è®¢å•çš„é‡‘é¢"

### P2çº§åˆ«ï¼ˆ3æ˜Ÿï¼‰
11. ä¼ä¸šç®¡ç†å‘˜å¯è®¾ç½®"é¡¹ç›®é»˜è®¤åˆ¸"
12. åˆ¸ä½¿ç”¨è®°å½•æ”¯æŒå¯¼å‡º Excel
13. è´¹ç”¨ä¸­å¿ƒé¦–é¡µå¢åŠ "æœ¬æœˆå·²çœåˆ¸é‡‘é¢"å±•ç¤º
14. æ”¯æŒ"åˆ¸+ä½™é¢+å¾®ä¿¡/æ”¯ä»˜å®"æ··æ­
15. è®¢å•æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨è·³è½¬å›èµ„æºåˆ—è¡¨
16. å¢åŠ "åˆ¸å³å°†åˆ°æœŸæ—¥å†æé†’"è®¢é˜…

### P3çº§åˆ«ï¼ˆ2æ˜Ÿï¼‰
17. è´¹ç”¨é¢„ä¼°å™¨å°ç¨‹åº/å…¬ä¼—å·ç‰ˆ
18. å¯¹æ¥ä¼ä¸šå¾®ä¿¡/é’‰é’‰å®¡æ‰¹æµ
19. æ”¯æŒ"åˆ¸è½¬èµ "ç»™åŒä¸€ç»„ç»‡å­è´¦å·
20. å¢åŠ "åˆ¸ä½¿ç”¨è¿›åº¦çœ‹æ¿"å¤§å±

---

## ğŸ“ ä»£ç å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `/components/dialogs/BalanceWarningDialog.tsx` - ä½™é¢é¢„è­¦å¯¹è¯æ¡†
2. `/BILLING_OPTIMIZATION_COMPLETE.md` - å®Œæ•´ä¼˜åŒ–è®¾è®¡æ–‡æ¡£
3. `/BILLING_OPTIMIZATION_IMPLEMENTATION.md` - å®æ–½æ€»ç»“æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
1. `/components/PaymentDialog.tsx` - æ ¸å¿ƒæ”¯ä»˜å¯¹è¯æ¡†
   - âœ… æ·»åŠ æ™ºèƒ½æ¨èé€»è¾‘
   - âœ… æ·»åŠ ä¸€é”®å…¨é¢æŠµæ‰£
   - âœ… æ·»åŠ ä¸€é”®é‡æ–°æ¨è
   - âœ… æ·»åŠ æ··åˆæ”¯ä»˜è®¡ç®—
   - âœ… æ·»åŠ åˆ¸ä¼˜å…ˆçº§æ’åº
   - âœ… æ·»åŠ åˆ¸é«˜äº®å’Œé¢„è­¦æ ‡ç­¾

2. `/components/pages/BillingPage.tsx` - è´¹ç”¨ä¸­å¿ƒé¡µé¢
   - âœ… æ·»åŠ ä½™é¢é¢„è­¦æ£€æŸ¥
   - âœ… é›†æˆBalanceWarningDialog

3. `/services/voucherService.ts` - åˆ¸æœåŠ¡
   - âœ… ä¼˜åŒ–æ’åºç®—æ³•ï¼ˆå·²åŒ…å«åœ¨åŸæœ‰ä»£ç ä¸­ï¼‰

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [x] æ™ºèƒ½æ¨èè‡ªåŠ¨è§¦å‘
- [x] ä¸€é”®å…¨é¢æŠµæ‰£æ­£ç¡®è®¡ç®—
- [x] ä¸€é”®é‡æ–°æ¨èåˆ·æ–°åˆ¸åˆ—è¡¨
- [x] æ··åˆæ”¯ä»˜æ­£ç¡®è®¡ç®—ï¼ˆåˆ¸+ä½™é¢+ç¬¬ä¸‰æ–¹ï¼‰
- [x] åˆ¸æŒ‰ä¼˜å…ˆçº§æ­£ç¡®æ’åºï¼ˆ7å¤©>30å¤©>ä½™é¢ï¼‰
- [x] åˆ¸é«˜äº®æ­£ç¡®æ˜¾ç¤ºï¼ˆç´§æ€¥çº¢è‰²ã€é¢„è­¦æ©™è‰²ï¼‰
- [x] ä½™é¢é¢„è­¦æ­£ç¡®è§¦å‘ï¼ˆâ‰¤7å¤©ï¼‰
- [x] ä»Šæ—¥ä¸å†æç¤ºåŠŸèƒ½æ­£å¸¸
- [x] å……å€¼å»ºè®®æ­£ç¡®è®¡ç®—

### è¾¹ç•Œæµ‹è¯•
- [x] æ— å¯ç”¨åˆ¸æ—¶æ­£å¸¸æ˜¾ç¤º
- [x] åˆ¸ä½™é¢ä¸º0æ—¶è‡ªåŠ¨è¿‡æ»¤
- [x] åˆ¸å·²è¿‡æœŸæ—¶è‡ªåŠ¨è¿‡æ»¤
- [x] ä½™é¢ä¸º0æ—¶æ··åˆæ”¯ä»˜æ­£ç¡®
- [x] å®Œå…¨æŠµæ‰£æ—¶å®ä»˜æ˜¾ç¤ºÂ¥0
- [x] åˆ¸ä¸è¶³æ—¶æç¤ºè¡¥å……æ”¯ä»˜

### UI/UXæµ‹è¯•
- [x] åŠ è½½çŠ¶æ€æ˜¾ç¤º
- [x] æˆåŠŸ/å¤±è´¥æç¤º
- [x] æŒ‰é’®ç¦ç”¨çŠ¶æ€
- [x] å“åº”å¼å¸ƒå±€
- [x] é¢œè‰²å’Œå›¾æ ‡æ­£ç¡®

---

## ğŸ¯ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸå®ç°äº†P0çº§åˆ«çš„4ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

1. **ä¸€é”®æ“ä½œ** - ç®€åŒ–æ”¯ä»˜æµç¨‹ï¼Œæå‡æ•ˆç‡
2. **æ™ºèƒ½æ¨è** - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç»„åˆï¼Œé™ä½å†³ç­–æˆæœ¬
3. **æ··åˆæ”¯ä»˜** - åˆ¸+ä½™é¢è‡ªåŠ¨ç»„åˆï¼Œæå‡è½¬åŒ–ç‡
4. **é¢„è­¦æé†’** - åˆ¸åˆ°æœŸå’Œä½™é¢ä¸è¶³æå‰é¢„è­¦ï¼Œé¿å…æµªè´¹

è¿™äº›ä¼˜åŒ–æ˜¾è‘—æå‡äº†ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿå¯ç”¨æ€§ï¼Œä¸ºåç»­P1-P3çº§åˆ«ä¼˜åŒ–å¥ å®šäº†åšå®åŸºç¡€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**å®Œæˆæ—¥æœŸ**: 2024-12-06  
**å®æ–½å›¢é˜Ÿ**: è´¹ç±³é›†ç¾¤å¼€å‘å›¢é˜Ÿ
