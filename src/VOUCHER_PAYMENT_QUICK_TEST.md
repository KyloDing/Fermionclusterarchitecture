# 政府算力券支付功能 - 快速测试指南

## 🚀 快速开始

### 测试路径
```
费用中心 → 订单管理 → 查看未支付订单 → 立即支付 → 选择算力券 → 确认支付
```

## 📝 测试用例

### 测试用例 1：智能选择算力券（完全抵扣）

**步骤：**
1. 进入"费用中心 - 订单管理"
2. 筛选"支付状态：未支付"
3. 找到订单 `ORD202411270001` (ResNet-50图像分类训练，¥2,550.00)
4. 点击右侧的"眼睛"图标查看详情
5. 点击底部"立即支付"按钮
6. 观察支付对话框自动加载和选择算力券

**预期结果：**
- ✅ 显示 5 张可用算力券
- ✅ 自动选择算力券（优先选择快到期的）
- ✅ 总抵扣金额：¥2,550.00
- ✅ 实付金额：¥0.00
- ✅ 显示绿色完全抵扣提示框："算力券已完全抵扣订单金额，无需额外支付"
- ✅ 确认支付按钮显示"确认支付 ¥0.00"

---

### 测试用例 2：部分抵扣

**步骤：**
1. 继续使用测试用例 1 的订单
2. 在支付对话框中，取消选择几张算力券
3. 观察实付金额变化

**预期结果：**
- ✅ 取消选择后，总抵扣金额减少
- ✅ 实付金额相应增加
- ✅ 支付按钮实时更新显示金额
- ✅ 抵扣明细卡片实时更新

**示例：**
- 只选择"国家东数西算算力券项目"（余额 ¥75,000）
- 总抵扣：¥2,550.00
- 实付：¥0.00

---

### 测试用例 3：快到期提醒

**步骤：**
1. 在支付对话框中查看算力券列表
2. 找到有效期栏

**预期结果：**
- ✅ 30天内到期的算力券显示橙色警告标签："X天后到期"
- ✅ 快到期的算力券自动排在前面
- ✅ 查看"四川省智算中心补贴"和"算力普惠工程"（2024-11-30 和 2024-11-18 到期）

---

### 测试用例 4：算力券分类

**步骤：**
1. 观察算力券列表中的分类标签

**预期结果：**
- ✅ 国家级：红色背景 ("国家东数西算算力券项目")
- ✅ 省级：蓝色背景 ("四川省智算中心补贴"、"算力普惠工程")
- ✅ 市级：绿色背景 ("成都市AI产业发展专项")
- ✅ 专项：紫色背景 ("人工智能创新应用试点")

---

### 测试用例 5：手动调整和智能选择

**步骤：**
1. 手动取消所有算力券
2. 点击"智能选择"按钮
3. 观察系统重新选择算力券

**预期结果：**
- ✅ 智能选择按钮可点击
- ✅ 点击后自动选中推荐的算力券
- ✅ 选择逻辑：优先快到期 + 余额从大到小

---

### 测试用例 6：不同订单类型匹配

**测试订单 A：容器实例**
- 订单号：`ORD202411270002` (Jupyter数据分析环境)
- 订单类型：instance
- 金额：¥1,280.00

**预期可用算力券：**
- ✅ 国家东数西算算力券项目 (适用范围包含 instance)
- ✅ 四川省智算中心补贴 (适用范围包含 instance)
- ✅ 成都市AI产业发展专项 (适用范围包含 instance)
- ✅ 算力普惠工程 (适用范围包含 instance)
- ❌ 人工智能创新应用试点 (仅适用 training/inference)

---

**测试订单 B：GPU算力包**
- 订单号：`ORD202411260005` (V100算力包周套餐)
- 订单类型：gpu
- 金额：¥6,720.00

**预期可用算力券：**
- ✅ 国家东数西算算力券项目 (适用范围包含 gpu)
- ✅ 成都市AI产业发展专项 (适用范围包含 gpu)
- ✅ 算力普惠工程 (适用范围包含 gpu)
- ❌ 四川省智算中心补贴 (不包含 gpu)
- ❌ 人工智能创新应用试点 (仅适用 training/inference)

---

### 测试用例 7：支付流程

**步骤：**
1. 选择订单 `ORD202411270001`
2. 点击"立即支付"
3. 保持默认选择的算力券
4. 点击"确认支付"按钮
5. 等待支付完成

**预期结果：**
- ✅ 支付按钮变为"支付中..."并显示加载图标
- ✅ 按钮禁用，防止重复点击
- ✅ 1秒后显示成功 Toast：
  - 标题："支付成功！"
  - 描述："已使用 X 张算力券，抵扣 ¥X,XXX.XX"
- ✅ 自动关闭支付对话框
- ✅ 自动关闭订单详情对话框

---

### 测试用例 8：空状态

**步骤：**
1. 选择一个 storage 类型的订单（暂无可用算力券）

**预期结果：**
- ✅ 显示空状态图标（大号票券图标）
- ✅ 显示提示文字："暂无可用算力券"
- ✅ 显示引导文案："您可以前往'费用中心 - 政府算力券'申请算力券"
- ✅ 不显示"智能选择"按钮

---

## 🎯 关键测试点

### 1. 算力券筛选准确性
- [ ] 只显示状态为 active 的算力券
- [ ] 只显示余额 > 0 的算力券
- [ ] 只显示适用范围匹配的算力券
- [ ] 只显示未过期的算力券

### 2. 智能排序
- [ ] 30天内到期的优先
- [ ] 快到期的按时间从早到晚
- [ ] 其他按余额从大到小

### 3. 金额计算
- [ ] 抵扣金额计算正确
- [ ] 实付金额 = 订单金额 - 总抵扣
- [ ] 完全抵扣时实付金额为 ¥0.00
- [ ] 金额格式化正确（保留2位小数）

### 4. UI交互
- [ ] 复选框状态正确
- [ ] 点击行可以切换选择状态
- [ ] 选中的行高亮显示（紫色背景）
- [ ] 智能选择按钮正常工作
- [ ] 支付按钮禁用状态正确

### 5. 响应式设计
- [ ] 大屏幕显示完整
- [ ] 小屏幕表格可横向滚动
- [ ] 对话框最大高度限制生效
- [ ] 内容溢出时可滚动

---

## 🐛 已知问题和限制

### 当前版本限制
1. **模拟数据**：所有算力券和支付都是模拟数据
2. **支付方式**：当前仅支持算力券支付，未集成其他支付方式
3. **实时更新**：支付成功后订单状态不会实时更新（需刷新页面）
4. **并发控制**：未实现算力券并发使用控制

### 下一步优化
1. 集成真实的后端 API
2. 添加其他支付方式（账户余额、支付宝、微信等）
3. 实现订单状态实时更新
4. 添加算力券使用记录查询
5. 优化性能（大量算力券场景）

---

## 📊 测试数据汇总

### 可用算力券（5张）

| 算力券 | 分类 | 余额 | 总额 | 到期日 | 适用范围 |
|--------|------|------|------|--------|---------|
| 国家东数西算算力券项目 | 国家级 | ¥75,000 | ¥100,000 | 2024-12-31 | training, inference, instance, gpu |
| 四川省智算中心补贴 | 省级 | ¥38,000 | ¥50,000 | 2024-11-30 ⚠️ | training, inference, instance |
| 成都市AI产业发展专项 | 市级 | ¥21,500 | ¥30,000 | 2024-12-15 | training, inference, instance, gpu, storage |
| 人工智能创新应用试点 | 专项 | ¥45,000 | ¥80,000 | 2024-11-20 ⚠️ | training, inference |
| 算力普惠工程 | 省级 | ¥15,000 | ¥20,000 | 2024-11-18 ⚠️ | training, inference, instance, gpu |

⚠️ = 30天内到期

### 测试订单（3个未支付）

| 订单号 | 类型 | 名称 | 金额 | 状态 |
|--------|------|------|------|------|
| ORD202411270001 | training | ResNet-50图像分类训练 | ¥2,550.00 | 运行中/未支付 |
| ORD202411270002 | instance | Jupyter数据分析环境 | ¥1,280.00 | 待启动/未支付 |
| ORD202411260005 | gpu | V100算力包周套餐 | ¥6,720.00 | 待启动/未支付 |

---

## ✅ 完成标准

测试通过需要满足：
- [ ] 所有测试用例执行完毕
- [ ] 所有关键测试点验证通过
- [ ] UI 显示正常，无布局错误
- [ ] 交互流畅，无卡顿
- [ ] 计算准确，无金额错误
- [ ] 提示信息清晰明确

---

## 📞 问题反馈

如发现问题，请记录：
1. 测试用例编号
2. 问题描述
3. 重现步骤
4. 预期结果 vs 实际结果
5. 截图（如有）
